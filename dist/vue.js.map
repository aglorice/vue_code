{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\r\n\r\n\r\nlet oldArrayProto = Array.prototype; // 获取数组的原型\r\n\r\n// https://blog.csdn.net/XuM222222/article/details/98742164（Object.create 解释）\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\n\r\n// 只有这七种方法可以改变数据\r\nlet methods = [\r\n    'push',\r\n    'sort',\r\n    'shift',\r\n    'unshift',\r\n    'splice',\r\n    'reverse',\r\n    'pop'\r\n]\r\nmethods.forEach(method=>{\r\n    newArrayProto[method] = function (...args){ // 重写了数组的方法\r\n        const result = oldArrayProto[method].call(this,...args); // 内部调用原来的方法，函数的劫持，切片编程\r\n        console.log('method',method);\r\n\r\n        let inserted;\r\n        let ob = this.__ob__\r\n        switch (method){\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        console.log(inserted); // 新增的内容\r\n        if(inserted){\r\n            ob.observeArray(inserted)\r\n        }\r\n        return result;\r\n    }\r\n})\r\n","import {newArrayProto} from \"./array\";\r\n\r\n\r\nclass Observe{\r\n    constructor(data) {\r\n        // Object.defineProperty 劫持已有的属性\r\n        // 不可枚举\r\n        Object.defineProperty(data,'__ob__',{\r\n            value:this,\r\n            enumerable:false // 将__ob__变成不可枚举\r\n        });\r\n        if(Array.isArray(data)){\r\n            // 重写数组中的几个方法\r\n            data.__proto__ = newArrayProto // 保留原有数组的方法，并且对其修改\r\n            this.observeArray(data)\r\n        }else {\r\n            this.walk(data)\r\n        }\r\n\r\n    }\r\n    walk(data){ // 循环对象，对属性依次劫持\r\n        // 重新定义数据\r\n        Object.keys(data).forEach(key=>defineReactive(data,key,data[key]));\r\n    }\r\n    observeArray(data){\r\n        data.forEach(item=> observe(item))  // 将数组中的每一项进行观测\r\n    }\r\n}\r\n\r\n\r\nexport function defineReactive(target,key,value){ // 闭包\r\n    observe(value)\r\n    Object.defineProperty(target,key,{\r\n        get() { // 取值的时候调用get\r\n            return value;\r\n        },\r\n        set(newValue) { // 修改的时候调用\r\n            if(newValue === value) return\r\n            observe(newValue) // 判断是否为对象，是则继续进行劫持\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\nexport function observe(data){\r\n    // 对这个对象进行劫持\r\n    if (typeof data !== 'object' || data === null){\r\n        return;  // 只对对象进行劫持\r\n    }\r\n    if (data.__ob__ instanceof Observe){\r\n        return data.__ob__;\r\n    }\r\n    return new Observe(data);\r\n}\r\n","import {observe} from \"./observe/index\";\r\n\r\n// 状态初始化\r\nexport function initState(vm){\r\n    // 状态初始化\r\n    const opts = vm.$options; // 获取所有的选项\r\n    if(opts.data){ // 如果有数据就进行数据初始化\r\n        initData(vm);\r\n    }\r\n}\r\n// 对数韩进行初始化\r\nfunction initData(vm){\r\n    let data =  vm.$options.data;\r\n    // 判断用户的数据是函数还是对象\r\n    data = typeof data === 'function' ? data.call(vm) : data;\r\n    //\r\n    vm._data = data;\r\n    // 对数据进行劫持（使用defineProperty）\r\n    //\r\n    observe(data);\r\n\r\n    // 将vm_data 代理\r\n    for(let key in data){\r\n        proxy(vm,'_data',key);\r\n    }\r\n}\r\n\r\n// 给vm._data 加上代理\r\nfunction proxy(vm,target,key){\r\n    Object.defineProperty(vm,key,{\r\n        get() {\r\n            return vm[target][key];\r\n        },\r\n        set(newValue) {\r\n            vm[target][key] = newValue;\r\n        }\r\n    })\r\n}\r\n","import {initState} from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options){\r\n        // 用作初始化操作\r\n        const  vm = this;\r\n        this.$options = options;  // 将用户的选项挂载到实例上\r\n        // 初始化状态\r\n        initState(vm);\r\n        //\r\n    }\r\n}// 给vue增加init方法\r\n\r\n\r\n","// 通过构造函数来实现\r\nimport {initMixin} from \"./init\";\r\n\r\nfunction Vue(options){  // 接收用户的选项\r\n    this._init(options);\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue\r\n\r\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","console","log","inserted","ob","__ob__","slice","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initData","_data","proxy","initMixin","Vue","_init","options"],"mappings":"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"}